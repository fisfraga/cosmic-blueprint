# Frontend Specification — Cosmic Blueprint
**Generated by:** @ux-design-expert (Uma) — Brownfield Discovery Phase 3
**Date:** 2026-02-20
**Workflow:** brownfield-discovery v2.0

---

## Overview

Cosmic Blueprint's frontend is a feature-rich, dark-themed React SPA with a "digital temple" aesthetic. It serves dual purposes: a **knowledge graph explorer** (browse wisdom traditions) and a **personal contemplation platform** (AI-guided self-discovery). The design system is built on elemental symbolism and sacred geometry metaphors.

---

## 1. Design System

### 1.1 Color Architecture

The design system defines **11 semantic color scales** in `tailwind.config.js`, each tied to a wisdom tradition or philosophical concept:

| Scale | Purpose | Primary Hex | Usage Pattern |
|-------|---------|-------------|---------------|
| `fire` | Fire element / Aries/Leo/Sagittarius signs | `#FF6B35` | Planets, fire signs |
| `earth` | Earth element / Taurus/Virgo/Capricorn | `#2D5016` | Earth signs |
| `air` | Air element / Gemini/Libra/Aquarius | `#4A90D9` | Air signs |
| `water` | Water element / Cancer/Scorpio/Pisces | `#1A5F7A` | Water signs |
| `humandesign` | Human Design system | `#F59E0B` | HD gates, centers, channels |
| `genekey` | Gene Keys system | `#8B5CF6` | Gene key entities |
| `numerology` | Numerology system | `#f5a623` | Numerology numbers |
| `alchemy` | Hermetic/Alchemical tradition | `#7c3aed` | Hermetic principles |
| `chakra` | Chakra energy system | `#db2777` | Chakra entities |
| `neutral` | Dark theme backgrounds/text | `#0D0D15` bg | All structural UI |

**Dark theme only:** The app has no light mode. Background is `neutral-background` (`#0D0D15`).

**Centralized color tokens:** `src/styles/colors.ts` exports typed `ElementColorSet` objects (gradient, border, text, bg, accent, ring) for programmatic color application in `EntityCard` and similar components.

**Design system inconsistency found:** `Home.tsx` uses raw Tailwind colors (`from-blue-500/15`, `text-blue-300`) for the Astrology tradition card instead of the custom `air-*` scale. This breaks color system consistency — the Astrology tradition should use `air` colors or a dedicated `astrology` scale.

### 1.2 Typography

| Font | Weight | Usage | Source |
|------|--------|-------|--------|
| Cinzel (serif) | 400, 600, 700 | All headings (h1–h6) | Google Fonts |
| Inter (sans-serif) | 300, 400, 500, 600, 700 | Body text, UI labels | Google Fonts |

**Implementation:** Fonts loaded via Google Fonts link in `index.html` with `preconnect`. Applied via `globals.css` base layer:
```css
body { font-family: 'Inter', sans-serif; }
h1, h2, h3, h4, h5, h6 { font-family: 'Cinzel', serif; }
```

**Issue:** No `font-display: swap` specified in Google Fonts URL — could cause FOUT (Flash of Unstyled Text) on slow connections. URL should include `&display=swap` parameter (currently present ✅).

**Issue:** Cinzel is a display font with limited character support. It may render poorly for non-Latin characters or edge-case symbols.

### 1.3 Animation System

**Framer Motion** (v10.16.16) is used extensively — **218 `motion.` usages** across the codebase.

Common patterns:
- `motion.div` with `initial/animate/exit` for page sections
- `AnimatePresence` for route transitions and modal overlays
- `PageTransition` wrapper component for route-level animations
- Staggered card animations with `delay` prop (`i * 0.1`)
- `LoadingSkeleton` cards use `motion.div` with opacity fade-in

**Issue:** Framer Motion v10 is one major version behind v11. v11 introduced breaking API changes and significant performance improvements (native animations). Migration needed but non-trivial.

**Issue:** No `prefers-reduced-motion` media query honored in the animation system. Users with vestibular disorders or motion sensitivity cannot disable animations.

### 1.4 Custom CSS Utilities (`globals.css`)

3 custom animation classes defined:
- `.animate-fade-in` — 0.2s ease-out opacity fade
- `.animate-slide-in-right` — 0.3s slide from right (entity panel)
- `.animate-slide-out-right` — 0.3s slide to right (entity panel close)

Also uses Tailwind's `animate-pulse` for skeleton loaders.

---

## 2. Component Inventory

### 2.1 Shared Components (24 total)

| Component | Lines | Type | Notes |
|-----------|-------|------|-------|
| `Layout.tsx` | 731 | Shell | Navigation, header, outlet |
| `ProfileCreationForm.tsx` | 624 | Form | Birth data entry — large but focused |
| `BodyGraph.tsx` | 622 | Visualization | Human Design body graph (D3/SVG) |
| `ConstellationGraph.tsx` | 568 | Visualization | Force-directed D3 graph |
| `HouseSubstanceWheel.tsx` | 334 | Visualization | Zodiac wheel with houses |
| `ChakraBodyViz.tsx` | 327 | Visualization | Chakra body overlay visualization |
| `SearchBar.tsx` | 306 | UI | Global entity search with results |
| `TransitCalendar.tsx` | 284 | UI | Transit calendar view |
| `InsightSaveButton.tsx` | 255 | UI | Save contemplation insight CTA |
| `NeutrinoWidget.tsx` | 248 | Widget | Human Design neutrino display |
| `EntityCard.tsx` | 241 | UI | Universal entity card (3 variants) |
| `CosmicWeatherWidget.tsx` | 240 | Widget | Current planetary transits |
| `CelestialMandala.tsx` | 230 | Visualization | D3 zodiac wheel |
| `ProfileBodyGraph.tsx` | 195 | UI | Profile-specific HD body graph |
| `AuthModal.tsx` | — | Modal | Sign in / magic link UI |
| `Breadcrumb.tsx` | — | Navigation | Page breadcrumb trail |
| `FilterBar.tsx` | — | UI | Entity list filters |
| `LoadingSkeleton.tsx` | 156 | Loading | Skeleton variants (4 types) |
| `NotFoundState.tsx` | — | Error | 404 state |
| `PageTransition.tsx` | — | Animation | Route transition wrapper |
| `ProfileSelector.tsx` | — | Navigation | Profile switcher dropdown |
| `UserMenu.tsx` | — | Navigation | Auth user menu |
| `entities/EntityDetailPanel.tsx` | — | Panel | Slide-in entity detail sidebar |
| `entities/EntityPicker.tsx` | — | UI | Entity search/selection input |

### 2.2 Entity Card System

`EntityCard` supports 3 variants: `default`, `compact`, `full`. Colors are derived dynamically from entity type via `getElementColor()`. This is the primary reusable card pattern across all 70+ entity list pages.

**Strength:** Consistent visual language across all entity types.
**Issue:** Card variant selection is not systematically documented — when to use `compact` vs `default` vs `full` is ad-hoc per page.

### 2.3 Visualization Components

4 D3-based interactive visualizations:

| Component | D3 Usage | Interaction | A11y |
|-----------|----------|------------|------|
| `CelestialMandala` | SVG arc/pie | Click sign → navigate | ❌ No aria |
| `ConstellationGraph` | Force simulation | Drag, click → navigate | ❌ No aria |
| `BodyGraph` | SVG custom layout | Click gate/center | ❌ No aria |
| `HouseSubstanceWheel` | SVG arc/wheel | Static display | ❌ No aria |

All 4 D3 visualizations produce SVG output with **no ARIA roles, labels, or keyboard navigation**. These are entirely inaccessible to screen reader users.

---

## 3. Page Architecture

### 3.1 Route Count & Scale

| Category | Count | Notes |
|----------|-------|-------|
| Knowledge list pages | 25 | Entity type lists |
| Knowledge detail pages | 30 | Entity detail views |
| Profile pages | 10 | Personal profile by tradition |
| Tool pages | 6 | Wheel, Graph, Contemplation, Transits, Pathways, Life Areas |
| Library pages | 2 | Insights, Sessions |
| Auth/onboarding | 2 | Onboarding, (login via modal) |
| **Total routes** | **~85** | All lazy-loaded |

### 3.2 Largest Pages

| Page | Lines | Issue |
|------|-------|-------|
| `ContemplationChamber.tsx` | 1,346 | God component — manages AI state, persona selection, streaming, history, entity picking, insight saving |
| `Profile.tsx` | 1,202 | God component — hub page with tabs, profile management, all 3 traditions |
| `Onboarding.tsx` | 742 | Multi-step form with tabs |
| `Transits.tsx` | 694 | Complex transit display + calendar |
| `Pathways.tsx` | 664 | Journey management + step rendering |
| `ProfileHumanDesign.tsx` | 558 | HD-specific profile dashboard |
| `Home.tsx` | 531 | Landing/dashboard with multiple sections |

### 3.3 Navigation Structure

`Layout.tsx` provides a **complex sidebar navigation** with 8 sections and 40+ nav items:

```
Navigation Sections:
├── Profile (5 items: Overview, Placements, Astrology, GK, HD)
├── Explore Tools (8 items: Wheel, Graph, Weaver, Realms, Transits, Life Areas, Pathways, Sessions)
├── Astrology Library (8 items)
├── Human Design Library (8 items)
├── Gene Keys Library (7 items)
├── Wisdom Traditions (3 items: Numerology, Chakras, Hermetic)
├── Insights (1 item)
└── Learn (4 items — all "Coming Soon")
```

**Issue:** Navigation has 40+ items with no search or filtering. On smaller viewports, the sidebar becomes overwhelming. The "Learn" section shows 4 placeholder items — dead nav links pointing to `#`.

**Issue:** Mobile navigation exists as a separate simplified nav (`mobileNav` array in `Layout.tsx`) but its relationship to the full sidebar is unclear — are all 40+ items accessible on mobile?

---

## 4. User Flows

### 4.1 Onboarding Flow
1. First visit → redirect to `/onboarding`
2. Welcome screen → data input (name, birth date, time, location, timezone)
3. Optional: import from AstroSeek or myBodyGraph via paste
4. Profile calculation → save to localStorage
5. Redirect to `/profile`

**Issues:**
- Timezone selection is limited to ~20 options — not globally comprehensive (missing many Asian, African, Pacific time zones)
- No geocoding — user must manually enter latitude/longitude coordinates
- No validation feedback on invalid birth time (e.g., "25:00")
- Location field (`cityOfBirth`) stored as display label only — no reverse geocoding to verify coordinates

### 4.2 Profile Creation (Additional Profiles)
- From `/profile` → add profile button → `ProfileCreationForm` modal
- Same data entry flow as onboarding
- Max 10 profiles enforced client-side only

### 4.3 Contemplation Flow
1. Navigate to `/contemplate`
2. Select category (Astrology / HD / Gene Keys / Cross-System) and type
3. Optionally select focus entity (planet, gate, key, etc.)
4. AI response streams in real-time
5. User can save insights via `InsightSaveButton`
6. Session persists (saved to localStorage + optional Supabase sync)

**Issue:** `ContemplationChamber.tsx` at 1,346 lines handles all of this in a single component — persona selection, category/type selection, entity picking, AI streaming, session management, insight saving. Should be decomposed into sub-components.

### 4.4 Knowledge Exploration
- Browse any entity list (e.g., `/planets`)
- Filter by element/type via `FilterBar`
- Search globally via `SearchBar`
- Click entity → detail page
- Detail page includes `EntityDetailPanel` sidebar for cross-references

---

## 5. Loading & Error States

### 5.1 Loading States

| Pattern | Component | Coverage |
|---------|-----------|---------|
| Skeleton variants | `LoadingSkeleton` (4 variants) | Data-loaded sections |
| Lazy route suspense | Generic `<PageLoader>` ("Loading...") | All 85 routes |
| Inline spinner | `LoadingSpinner` | Buttons, small areas |
| Framer Motion opacity | Various pages | Section reveals |

**Issue:** The lazy-loaded route fallback (`PageLoader`) shows only "Loading..." plain text, while `LoadingSkeleton` component supports 4 rich skeleton variants. This is inconsistency — route transitions use the generic loader but in-page loading uses proper skeletons.

**Recommendation:** Route-level `<Suspense>` fallbacks should use `<LoadingSkeleton variant="page" />` instead of the plain text loader.

### 5.2 Error States

| State | Component | Coverage |
|-------|-----------|---------|
| 404 / not found | `NotFoundState` | Some detail pages |
| AI API error | Inline error in `ContemplationChamber` | AI calls only |
| Supabase errors | Console log + silent fail | Sync operations |
| Calculation errors | Console log | Chart calculation |

**Critical Issue:** No **global React Error Boundary** in `App.tsx`. A runtime error in any page component will crash the entire app with a blank screen. This is especially risky given the complexity of D3 visualizations and AI streaming code.

---

## 6. Accessibility (A11y) Audit

### 6.1 Overall Assessment

**Rating: Poor** — The app has minimal accessibility support.

| Metric | Count | Target |
|--------|-------|--------|
| Total aria-* usages in codebase | 26 | 200+ |
| D3 visualizations with keyboard access | 0/4 | 4/4 |
| D3 visualizations with ARIA | 0/4 | 4/4 |
| Forms with proper labels | Partial | All |
| Color contrast verified | Unknown | WCAG AA |
| `prefers-reduced-motion` support | None | Full |
| Skip navigation link | Absent | Required |
| Focus management on route change | Not implemented | Required |

### 6.2 Specific Issues

| ID | Issue | Severity | Location |
|----|-------|----------|----------|
| A11Y-01 | D3 visualizations have no `aria-label`, `role`, or keyboard nav | HIGH | All 4 viz components |
| A11Y-02 | No `prefers-reduced-motion` media query — animations always play | HIGH | All motion usage |
| A11Y-03 | No skip navigation link — screen readers must tab through 40+ nav items | HIGH | `Layout.tsx` |
| A11Y-04 | Route changes don't manage focus or announce to screen readers | HIGH | `App.tsx` |
| A11Y-05 | Color is used as the sole differentiator for element types (fire/earth/air/water) | MEDIUM | `EntityCard.tsx` |
| A11Y-06 | `ProfileCreationForm` fields may lack proper `for`/`id` label associations | MEDIUM | `ProfileCreationForm.tsx` |
| A11Y-07 | `SearchBar` results may not be announced to screen readers | MEDIUM | `SearchBar.tsx` |
| A11Y-08 | Dark theme has no verified WCAG contrast ratios | MEDIUM | `tailwind.config.js` |
| A11Y-09 | Emoji used as nav icons without `aria-hidden` | LOW | `Layout.tsx` |
| A11Y-10 | "Coming Soon" nav items are non-functional links (`href="#"`) | LOW | `Layout.tsx` |

---

## 7. Responsive Design

| Breakpoint | Tailwind | Observed Usage |
|------------|---------|---------------|
| Mobile (default) | `sm:` | Limited |
| Tablet | `md:` | Card grids 2-col |
| Desktop | `lg:` | Card grids 3-col |
| Wide | `xl:` | Rare |

**Issue:** D3 visualizations use fixed pixel sizes (e.g., `CelestialMandala` `size = 500` default). On narrow viewports, these may overflow or be too small. No viewport-relative sizing observed.

**Issue:** Layout sidebar navigation — it's unclear if the full sidebar is visible/functional on mobile or if users are redirected to the simplified mobile nav. The relationship between desktop sidebar and mobile nav needs clarification.

---

## 8. Performance Observations

| Aspect | Status | Notes |
|--------|--------|-------|
| Code splitting | ✅ | All 85 routes lazy-loaded |
| Vendor chunking | ✅ | React, D3, Framer Motion in separate chunks |
| Knowledge base bundle size | ⚠️ | 29 JSON files bundled into app — all loaded at startup |
| Framer Motion bundle | ⚠️ | v10 — v11 has significant bundle size reduction |
| D3 imports | ⚠️ | `import * as d3 from 'd3'` — full D3 bundle, should use selective imports |
| Google Fonts | ⚠️ | External dependency — blocked renders if fonts.googleapis.com is unreachable |
| Animation volume | ⚠️ | 218 Framer Motion usages — potential performance impact on low-end devices |

**Issue:** `import * as d3 from 'd3'` in visualization components imports the entire D3 library (~500KB). Selective imports (e.g., `import { select } from 'd3-selection'`) would dramatically reduce bundle size.

**Issue:** All 29 knowledge base JSON files are bundled together via `src/data/index.ts`. Users of Gene Keys pages pay the cost of loading astrology and HD data too. A lazy-loaded data strategy could significantly improve initial load time.

---

## 9. UX Debt Summary

| ID | Debt | Severity | Area |
|----|------|----------|------|
| UX-01 | No global Error Boundary — crashes show blank screen | HIGH | Reliability |
| UX-02 | D3 visualizations completely inaccessible | HIGH | Accessibility |
| UX-03 | No `prefers-reduced-motion` support | HIGH | Accessibility |
| UX-04 | No skip navigation | HIGH | Accessibility |
| UX-05 | Route change focus management absent | HIGH | Accessibility |
| UX-06 | `ContemplationChamber.tsx` at 1,346L — God component | HIGH | Maintainability |
| UX-07 | `Profile.tsx` at 1,202L — God component | HIGH | Maintainability |
| UX-08 | Route suspense uses "Loading..." text instead of `LoadingSkeleton` | MEDIUM | UX Polish |
| UX-09 | No color contrast audit — dark theme WCAG compliance unverified | MEDIUM | Accessibility |
| UX-10 | Timezone list limited (~20 options) — not globally comprehensive | MEDIUM | Onboarding |
| UX-11 | No geocoding for birth location — manual lat/lon entry required | MEDIUM | Onboarding |
| UX-12 | Home.tsx uses raw Tailwind colors instead of design system | MEDIUM | Design Consistency |
| UX-13 | `d3` full import — should use selective imports | MEDIUM | Performance |
| UX-14 | 29 JSON files bundled at startup — all traditions loaded immediately | MEDIUM | Performance |
| UX-15 | Dead "Coming Soon" nav items — 4 non-functional links | LOW | Navigation |
| UX-16 | D3 viz fixed pixel sizes — no responsive sizing | LOW | Responsive |
| UX-17 | Emoji icons in navigation without aria-hidden | LOW | Accessibility |
| UX-18 | Framer Motion v10 — v11 available with better performance | LOW | Performance |

---

## 10. Strengths

- Consistent dark theme with meaningful elemental color coding
- Rich skeleton loading system (4 variants) — good perceived performance
- Full code splitting via React.lazy — 85+ routes, only loads what's needed
- Vendor chunk splitting (React, D3, Framer Motion) — clean bundle strategy
- Google Fonts properly loaded with `preconnect` and `display=swap`
- `PageTransition` component shows investment in smooth UX
- `EntityCard` provides a consistent visual language across 700+ entities
- `FilterBar` + `SearchBar` — good discoverability for knowledge graph

---

## 11. Questions for @architect Review

1. Should we adopt a lazy data loading strategy for the 29 JSON knowledge files, or is bundle size acceptable given the knowledge-graph nature of the app?
2. Is Framer Motion v11 migration planned? The API changes are breaking but the performance gains are significant.
3. What is the priority of accessibility improvements given the contemplative/personal nature of the app?
4. Should `ContemplationChamber.tsx` be split before or after the DB improvements to `contemplation_sessions`?
5. For D3 visualizations — is SVG with progressive enhancement (add a11y on top) acceptable, or should we migrate to a more accessible charting approach?

---

*Document Version: 1.0 — Phase 3 of 10 (Brownfield Discovery)*
*Next: Phase 4 (@architect — Consolidation Draft)*
