# Epic: Technical Debt Resolution — Cosmic Blueprint
**Generated by:** @pm (Morgan) — Brownfield Discovery Phase 10
**Date:** 2026-02-20
**Epic ID:** EPIC-TD-01
**Source:** Brownfield Discovery Assessment (Phases 1–9)

---

## Epic Overview

| Attribute | Value |
|-----------|-------|
| Epic Title | Technical Debt Resolution — Foundation, Safety, UX |
| Epic Goal | Eliminate all Critical and High technical debts to unblock scalable feature development |
| Business Value | Reduce regression risk, enable multi-profile B2B use, protect AI costs, improve accessibility |
| Priority | P0 — Start immediately after Sprint J |
| Estimated Effort | 200–330 hours |
| Planned Sprints | K, L, M, N (and ongoing in O+) |
| Epic Owner | Product Owner |
| Lead Agent | @dev (Dex) |

---

## Sprint Breakdown

### Sprint K — Safety Foundation

**Theme:** Make the app safe against crashes, cost spikes, and regressions before adding features.

| Story ID | Title | Points | Priority |
|----------|-------|--------|----------|
| TD-K-01 | Add CI/CD quality gates (lint + test + build) | 3 | P0 |
| TD-K-02 | Add rate limiting to `/api/claude` endpoint | 5 | P0 |
| TD-K-03 | Add global React Error Boundary | 2 | P0 |
| TD-K-04 | Add test suite for `chartCalculation.ts` | 8 | P0 |
| TD-K-05 | Add test suite for `ephemeris.ts` | 5 | P1 |
| TD-K-06 | Quick wins batch (skip nav, deletion confirm, loading, dead nav, DB indexes) | 5 | P1 |

---

### Sprint L — Data Integrity

**Theme:** Fix the database to properly isolate multi-profile data and protect user data.

| Story ID | Title | Points | Priority |
|----------|-------|--------|----------|
| TD-L-01 | Add `profile_id` FK to insights and sessions | 8 | P0 |
| TD-L-02 | Add full-text search to Insight Library | 5 | P1 |
| TD-L-03 | User data export feature | 5 | P1 |
| TD-L-04 | Expand service test coverage to 60% | 13 | P1 |
| TD-L-05 | CSP headers + API key documentation | 2 | P2 |

---

### Sprint M — Component Architecture

**Theme:** Decompose God components to unblock AI and profile feature development.

| Story ID | Title | Points | Priority |
|----------|-------|--------|----------|
| TD-M-01 | Decompose `ContemplationChamber.tsx` | 13 | P0 |
| TD-M-02 | Decompose `Profile.tsx` | 8 | P1 |
| TD-M-03 | Add `prefers-reduced-motion` support | 3 | P1 |
| TD-M-04 | Empty states for new users | 3 | P2 |

---

### Sprint N — Onboarding + Accessibility

**Theme:** Remove onboarding friction and meet accessibility standards.

| Story ID | Title | Points | Priority |
|----------|-------|--------|----------|
| TD-N-01 | Add geocoding to ProfileCreationForm | 13 | P0 |
| TD-N-02 | D3 visualizations: ARIA + keyboard navigation | 13 | P0 |
| TD-N-03 | Route change focus management | 3 | P1 |
| TD-N-04 | WCAG contrast audit and fixes | 5 | P2 |

---

## Acceptance Criteria (Epic Level)

- [ ] All 4 Critical debts resolved and verified
- [ ] CI/CD runs lint + typecheck + test + build on every push
- [ ] Test coverage ≥ 60% on all services
- [ ] Error Boundary active — verified via controlled error test
- [ ] `/api/claude` has rate limiting verified by load test
- [ ] `profile_id` FK active — Insight Library and Session Library filter by active profile
- [ ] User data export available in-app (JSON download)
- [ ] All 4 D3 visualizations keyboard-navigable with ARIA labels
- [ ] `prefers-reduced-motion` honored globally
- [ ] Skip navigation link present and functional
- [ ] Geocoding replaces manual lat/lon in ProfileCreationForm

---

## Definition of Done (Story Level)

Each story must:
1. Pass all existing tests (no regressions)
2. Pass linting (`npm run lint`)
3. Pass TypeScript check (`npm run build`)
4. Have new tests written for any new service logic
5. Be reviewed against the acceptance criteria of the story
6. Be pushed to GitHub via @devops

---

*Epic created by @pm (Morgan) — Phase 10 Complete*
*Brownfield Discovery COMPLETE*
