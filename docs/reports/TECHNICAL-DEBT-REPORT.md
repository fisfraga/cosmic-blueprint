# Technical Debt Report — Cosmic Blueprint
**Generated by:** @analyst (Atlas) — Brownfield Discovery Phase 9
**Date:** 2026-02-20
**For:** Stakeholders / Product Owner
**Based on:** Full Brownfield Discovery Assessment (Phases 1–8)

---

## Executive Summary

Cosmic Blueprint has successfully shipped 5 development sprints (G through J), building a sophisticated AI-powered wisdom platform. The technical foundation is **sound** — the architecture, domain model, and product vision are well-conceived. What exists is **expected technical debt** from rapid feature development.

**The bottom line:**

| | |
|-|-|
| **Total debt items** | 70 |
| **Business-blocking issues** | 4 (Critical) |
| **Should fix soon** | 22 (High) |
| **Estimated cost to resolve Critical + High** | ~**$15,000–25,000** (USD equivalent at $75/h) |
| **Cost of NOT resolving** | Risk of data loss, user churn, API cost spikes, legal exposure |
| **Recommended timeline** | 2–4 months (Sprints K–N) |

---

## Key Numbers

| Metric | Value |
|--------|-------|
| Total codebase lines | ~50,000+ |
| Services (business logic files) | 25 |
| Services with tests | 1 (4%) |
| Pages | 70+ |
| Database tables | 4 |
| AI contemplation types | 32+ |
| Wisdom tradition entities | 700+ |
| Tech debt items | 70 |
| Quick wins (≤2h, high impact) | 10 |

---

## The 4 Critical Issues

These are the issues that pose the most direct risk to the product and its users.

---

### Critical 1: The Product Has Almost No Tests

**In plain language:** The app has 25 files of core business logic — astrology calculations, chart generation, AI context building — with essentially no automated tests. Only 1 test file exists out of 25.

**What this means:**
- Every new feature added risks silently breaking existing features
- Every bug fix could introduce new bugs
- Refactoring any code is a gamble

**Real risk:** As the codebase grows (currently at ~Sprint 5), this becomes increasingly expensive. A bug in the birth chart calculation could show wrong planetary positions to every user without anyone noticing until a user reports it.

**Fix:** Add test coverage. Estimated **40–80 hours**. This is the highest-leverage investment available.

---

### Critical 2: Multi-Profile Users See Mixed Data

**In plain language:** The app supports up to 10 profiles per account (yourself, partner, child, client, etc.). But when you save insights from a contemplation session, the database doesn't record which profile was active. So the Insights Library shows all insights from all profiles mixed together.

**What this means:**
- A coach with 8 client profiles cannot filter insights by client
- Insights generated while reading your child's chart appear alongside your own
- Sessions Library has the same problem

**Fix:** A database migration linking insights and sessions to profiles. Estimated **10–16 hours**.

---

### Critical 3: The Core Visualizations Are Inaccessible

**In plain language:** The Celestial Wheel, Cosmic Graph, Body Graph, and Chakra Wheel — four of the most visually distinctive features — are built with D3.js and have no keyboard navigation or screen reader support. A user who relies on a keyboard or screen reader cannot interact with them at all.

**What this means:**
- Users with motor disabilities cannot use core features
- Screen reader users experience these as silent void areas
- This constitutes violations of WCAG 2.1 Level A (the baseline accessibility standard)

**Fix:** Add ARIA labels and keyboard navigation to all 4 visualizations. Estimated **24–40 hours**.

---

### Critical 4: No Protection Against Runaway AI Costs

**In plain language:** The app has a serverless function (`/api/claude`) that proxies requests to the AI API. Anyone who discovers this endpoint can call it unlimited times, generating significant API costs with no protection.

**What this means:**
- A single malicious actor (or even just a surge in traffic) could generate hundreds of dollars in API costs in minutes
- There is currently no rate limiting, origin validation, or request size capping

**Fix:** Add rate limiting and basic origin validation to the API proxy. Estimated **4–8 hours**.

---

## Cost Analysis

### Cost of Resolving

| Priority | Items | Estimated Hours | Estimated Cost* |
|----------|-------|----------------|----------------|
| Critical (4 items) | 4 | 72–115h | $5,400–$8,600 |
| High (22 items) | 22 | 85–155h | $6,375–$11,600 |
| Medium (32 items) | 32 | ~80h | $6,000 |
| Low (12 items) | 12 | ~30h | $2,250 |
| **Critical + High only** | **26** | **157–270h** | **$11,775–$20,250** |
| **All 70 items** | **70** | **267–380h** | **$20,025–$28,500** |

*At $75/hour blended development rate*

### Cost of NOT Resolving (Risk Accumulation)

| Risk | Probability (12mo) | Potential Cost |
|------|-------------------|---------------|
| Silent chart calculation bug ships to all users | Medium | Reputation damage, churn |
| API cost spike from unprotected endpoint | Medium | $500–$5,000 unplanned cost |
| User data loss event (localStorage, no backup) | Low | Churn, trust damage |
| Regression breaks core feature (no tests) | High | 2–5 days debugging × sprint delay |
| WCAG compliance issue raised by user/org | Low | Legal/reputational cost |
| Multi-profile coach can't use product effectively | High | Lost B2B segment |

**Estimated annualized risk value of NOT fixing Critical + High items: $15,000–$40,000**

---

## Impact on Business Areas

### Product Growth

The missing geocoding (manual lat/lon entry) and limited timezone support create a measurable friction point in onboarding. For users who are not already familiar with astrological apps, being asked to enter GPS coordinates is confusing and off-putting. This is a direct impact on new user activation rate.

### Premium / Coach Use Case

The multi-profile data co-mingling (Critical 2) directly limits the B2B coaching use case — a coach managing 8+ client profiles cannot effectively use the Insights Library as a case management tool. Fixing this unlocks a clear upsell tier.

### AI Feature Development

The `ContemplationChamber.tsx` file (1,346 lines) and `contemplation/context.ts` (1,463 lines) are so large that adding new AI contemplation types or personas requires navigating massive, untested files. Every AI feature sprint is slowed by this complexity.

### Data Safety and Trust

The app currently has no mechanism for users to export their data. Their insights, sessions, and profiles exist only in browser localStorage (with optional Supabase cloud sync). This is a trust and compliance gap. Users who switch devices or clear their browser can lose all their contemplation history.

---

## Recommended Timeline

### Phase 1: Foundation (Sprints K–L, ~6–8 weeks)

**Theme: "Make it safe to build on"**

1. Protect the API endpoint (rate limiting)
2. Add Error Boundary (no more blank screen crashes)
3. Add test coverage for core calculation logic
4. Fix the multi-profile data isolation (profile_id migration)
5. Add user data export
6. Quick wins: skip nav, profile deletion confirmation, loading states

**Estimated hours:** 100–150h

---

### Phase 2: User Experience (Sprints M–N, ~6–8 weeks)

**Theme: "Remove friction and open doors"**

1. Decompose the God components (ContemplationChamber, Profile)
2. Add geocoding to profile creation (no more lat/lon)
3. Fix D3 accessibility (keyboard + screen reader support)
4. Motion sensitivity support
5. Empty states, onboarding improvements

**Estimated hours:** 80–130h

---

### Phase 3: Architecture Health (Sprint O+, ongoing)

**Theme: "Set up for the next year"**

1. Refactor the AI service layer (context.ts, prompts.ts)
2. D3 selective imports (bundle size)
3. Knowledge base lazy loading
4. Google OAuth
5. Remaining medium/low items

**Estimated hours:** 80–120h

---

## Quick Wins — Do These First

These 10 items together take ~15 hours and solve real problems immediately:

| Item | Time | Impact |
|------|------|--------|
| Error Boundary in App.tsx | 2h | No more blank screen crashes |
| Rate limiting on API | 4h | Cost protection |
| Skip navigation link | 1h | Immediate a11y |
| Profile deletion confirmation | 2h | Prevent data loss |
| Route suspense → skeleton | 2h | Better loading UX |
| Remove dead "Coming Soon" nav | 1h | Cleaner navigation |
| Home.tsx design system fix | 1h | Visual consistency |
| Emoji aria-hidden | 1h | A11y |
| Pathway timestamp defaults | 1h | DB safety |
| DB indexes (category, type) | 1h | Insight Library performance |

**Total: ~16 hours → 10 improvements**

---

## Next Steps

1. Present this report and get budget approval for Sprints K–N
2. Prioritize the 10 Quick Wins to be started immediately
3. Activate @pm (Morgan) to create the Technical Debt Epic and first sprint stories
4. Start Sprint K with CI/CD audit and API rate limiting as first items

---

*Report generated by Brownfield Discovery Workflow v2.0*
*Full technical details: `docs/prd/technical-debt-assessment.md`*
*@analyst (Atlas) — Phase 9 Complete*
